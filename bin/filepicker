#!/usr/bin/env ruby

require 'rubygems'
begin
    require 'json'
rescue LoadError
    puts "You need to install json: gem install json"
      exit!(1)
end

config_file = "#{ENV['HOME']}/.filepicker"

unless File.exist?(config_file)
  puts "You need to type your API key " + config_file
  exit!(1)
end

api_key = File.read(config_file)

if ARGV[0].nil?
  puts "You need to specify a file to upload."
  exit!(1)
end

file_name = ARGV[0]

json_return = `curl -s -F fileUpload=@#{file_name} 'https://www.filepicker.io/api/store/S3?key=#{api_key}&filename=#{file_name}'`
url = JSON.parse(json_return)['url']
puts url

# copy to mac clipboard
`echo #{url} | pbcopy`